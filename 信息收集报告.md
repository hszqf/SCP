# SCP é¡¹ç›®ä¿¡æ¯æ”¶é›†æŠ¥å‘Š

æœ¬æŠ¥å‘Šé’ˆå¯¹"Unity build + å¯¼è¡¨å¯¼å‡º JSON"ä¸¤ä¸ª GitHub Actions æ”¶é›†å¿…è¦ä¿¡æ¯ã€‚

---

## ğŸ“ æ–‡ä»¶è·¯å¾„åˆ—è¡¨

### A) GitHub Actions å·¥ä½œæµ
- `.github/workflows/build-webgl.yml`

### B) é…ç½®æ–‡ä»¶
- `GameData/Local/game_data.xlsx` (Excel æºæ–‡ä»¶)
- `Assets/StreamingAssets/game_data.json` (JSON è¾“å‡ºæ–‡ä»¶)

### C) å¯¼è¡¨è„šæœ¬
- `tools/xlsx_to_json.py` (Python å¯¼è¡¨è„šæœ¬)

### D) ç›¸å…³ä»£ç æ–‡ä»¶
- `Assets/Scripts/Data/DataRegistry.cs` (æ•°æ®åŠ è½½ä¸æ³¨å†Œ)
- `Assets/Scripts/Runtime/GameController.cs` (æ¸¸æˆæ§åˆ¶å™¨ï¼Œå¯åŠ¨æ—¶åŠ è½½æ•°æ®)
- `Assets/Scripts/Editor/GameDataBuildMenu.cs` (Unity ç¼–è¾‘å™¨èœå•ï¼Œè°ƒç”¨å¯¼è¡¨è„šæœ¬)

### E) æ–‡æ¡£
- `æ¸¸æˆé…ç½®è¯´æ˜.md` (æ¸¸æˆé…ç½®å®Œæ•´è¯´æ˜æ–‡æ¡£)
- `WEBGL_ASYNC_LOADING_CHANGES.md` (WebGL å¼‚æ­¥åŠ è½½æ”¹é€ æ–‡æ¡£)
- `Docs/` ç›®å½•åŒ…å«å¤šä¸ªæŠ€æœ¯æ–‡æ¡£

---

## A) å·¥ä½œæµç°çŠ¶

### 1) .github/workflows ç›®å½•ä¸‹çš„æ–‡ä»¶
```
.github/workflows/build-webgl.yml
```
åªæœ‰ä¸€ä¸ª workflow æ–‡ä»¶ã€‚

---

### 2) Unity/WebGL æ„å»ºä¸å‘å¸ƒçš„ workflow å®Œæ•´å†…å®¹

**æ–‡ä»¶ï¼š`.github/workflows/build-webgl.yml`**

```yaml
name: Build & Deploy Unity WebGL to Pages

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Free disk space
        run: |
          echo "=== Disk space before cleanup ==="
          df -h /
          
          AVAILABLE_GB=$(df --output=avail / | tail -1 | awk '{print int($1/1024/1024)}')
          echo "Available disk space: ${AVAILABLE_GB}GB"
          
          # Only clean if less than 30GB available
          if [ "$AVAILABLE_GB" -lt 30 ]; then
            echo "Cleaning up disk space..."
            sudo rm -rf /usr/share/dotnet
            sudo rm -rf /usr/local/lib/android
            sudo rm -rf /opt/ghc
            sudo rm -rf /opt/hostedtoolcache/CodeQL
            sudo docker image prune -a -f || true
            sudo apt-get clean
          else
            echo "Sufficient disk space available, skipping cleanup"
          fi
          
          echo "=== Disk space after cleanup ==="
          df -h /

      - name: Migrate Docker data-root (if needed)
        run: |
          AVAILABLE_GB=$(df --output=avail / | tail -1 | awk '{print int($1/1024/1024)}')
          
          # Only migrate if less than 30GB available
          if [ "$AVAILABLE_GB" -lt 30 ]; then
            echo "Migrating Docker data-root to /mnt..."
            sudo systemctl stop docker
            sudo mkdir -p /mnt/docker-data
            sudo mv /var/lib/docker/* /mnt/docker-data/ || true
            
            sudo tee /etc/docker/daemon.json > /dev/null <<EOF
          {
            "data-root": "/mnt/docker-data"
          }
          EOF
            
            sudo systemctl start docker
            docker info | grep "Docker Root Dir"
          else
            echo "Sufficient disk space available, skipping Docker migration"
          fi

      - name: Restore Library cache
        uses: actions/cache@v3
        with:
          path: |
            Library
            Library/Bee
            Library/il2cpp_cache
          key: Library-${{ hashFiles('Assets/**', 'ProjectSettings/**', 'Packages/manifest.json') }}
          restore-keys: |
            Library-

      - name: Build WebGL
        uses: game-ci/unity-builder@v4
        env:
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
        with:
          targetPlatform: WebGL
          buildsPath: build
          buildName: WebGL

      - name: Locate WebGL root (folder containing index.html)
        id: webglroot
        run: |
          INDEX_PATH=$(find build -name index.html -type f | head -1)
          if [ -z "$INDEX_PATH" ]; then
            echo "ERROR: index.html not found under build/."
            echo "==== build tree ===="
            find build -type f | head -200
            exit 1
          fi
          ROOT_PATH=$(dirname "$INDEX_PATH")
          echo "WebGL root: $ROOT_PATH"
          echo "path=$ROOT_PATH" >> $GITHUB_OUTPUT

      - name: Prepare Pages staging directory
        run: |
          WEBGL_ROOT="${{ steps.webglroot.outputs.path }}"
          if [ ! -f "$WEBGL_ROOT/index.html" ]; then
            echo "ERROR: index.html not found in WebGL root: $WEBGL_ROOT"
            exit 1
          fi

          # clean staging
          rm -rf public

          # Create public directory
          mkdir -p public

          # Copy contents of WebGL root directly into public/ (preserve Build/ structure)
          cp -R "$WEBGL_ROOT"/. public/

          # Disable Jekyll
          touch public/.nojekyll

          echo "==== Staging directory structure (public) ===="
          ls -lah public
          echo "==== Build subdirectory ===="
          if [ -d "public/Build" ]; then
            ls -lah public/Build
          else
            echo "ERROR: public/Build not found after copy."
            exit 1
          fi

      - name: Upload Pages Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: public

  deploy:
    runs-on: ubuntu-latest
    needs: build
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

---

### 3) å½“å‰ WebGL å‘å¸ƒæ–¹å¼æ€»ç»“

**è¾“å‡ºç›®å½•ï¼š** 
- Unity æ„å»ºåˆ° `build/WebGL/`
- è„šæœ¬åŠ¨æ€æŸ¥æ‰¾ `index.html` æ‰€åœ¨ç›®å½•ï¼ˆ`build/WebGL/WebGL/` æˆ–ç±»ä¼¼ï¼‰
- å°† WebGL æ ¹ç›®å½•å†…å®¹å¤åˆ¶åˆ° `public/` ç›®å½•
- ä¸Šä¼  `public/` ç›®å½•ä½œä¸º Pages artifact

**å‘å¸ƒæ–¹å¼ï¼š**
- **ä½¿ç”¨ GitHub Pages** (é€šè¿‡ `actions/deploy-pages@v4`)
- **ä¸æ˜¯** æ¨é€åˆ° `gh-pages` åˆ†æ”¯
- **ä¸æ˜¯** ä½¿ç”¨ `docs/` ç›®å½•
- è€Œæ˜¯ä½¿ç”¨ GitHub Actions çš„ **Pages Artifact ä¸Šä¼ æœºåˆ¶**ï¼ˆç°ä»£åŒ–æ–¹å¼ï¼‰

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€åˆ° `main` åˆ†æ”¯
- æ‰‹åŠ¨è§¦å‘ (`workflow_dispatch`)

---

## B) é…ç½®æ–‡ä»¶è·¯å¾„ç°çŠ¶

### 4) game_data.xlsx çš„ä½ç½®
```
GameData/Local/game_data.xlsx
```

è¯¥ç›®å½•ä¸‹è¿˜æœ‰ï¼š
- `game_data_back.xlsx` (å¤‡ä»½æ–‡ä»¶)

---

### 5) game_data.json çš„ä½ç½®
```
Assets/StreamingAssets/game_data.json
Assets/StreamingAssets/game_data.json.meta  (Unity å…ƒæ•°æ®æ–‡ä»¶)
```

---

### 6) è¯»å– JSON çš„ä»£ç ä½ç½®ä¸å…³é”®ç‰‡æ®µ

#### æ–‡ä»¶ 1: `Assets/Scripts/Data/DataRegistry.cs` (è¡Œ 1-210)

**å…³é”®éƒ¨åˆ†ï¼šåŠ è½½é€»è¾‘**

```csharp
// è¡Œ 73
private const string GameDataFileName = "game_data.json";

// è¡Œ 77-78: Singleton å®ä¾‹åŠ è½½
private static DataRegistry _instance;
public static DataRegistry Instance => _instance ??= LoadFromStreamingAssets();

// è¡Œ 134-158: ä» StreamingAssets åŠ è½½ï¼ˆé™æ€æ–¹æ³•ï¼‰
private static DataRegistry LoadFromStreamingAssets()
{
    var registry = new DataRegistry();
    var path = Path.Combine(Application.streamingAssetsPath, GameDataFileName);
    Debug.Log($"[DataRegistry] Loading from: {path}");
    
    try
    {
        var json = LoadJsonText(path);
        LoadFromJson(json);
    }
    catch (Exception ex)
    {
        Debug.LogError($"[DataRegistry] Failed to load JSON: {ex}");
        throw;
    }
}

// è¡Œ 174-185: åŒæ­¥åŠ è½½ JSON æ–‡æœ¬ï¼ˆé WebGLï¼‰
private static string LoadJsonText(string path)
{
    if (Application.platform == RuntimePlatform.WebGLPlayer)
        throw new InvalidOperationException("[DataRegistry] WebGL cannot load JSON synchronously. Use LoadJsonTextCoroutine / LoadJsonTextAsync.");

    if (!File.Exists(path))
    {
        throw new FileNotFoundException($"[DataRegistry] Missing game data at: {path}", path);
    }

    return File.ReadAllText(path);
}

// è¡Œ 187-201: WebGL å¼‚æ­¥åŠ è½½åç¨‹ï¼ˆä½¿ç”¨ UnityWebRequestï¼‰
public static IEnumerator LoadJsonTextCoroutine(string url, Action<string> onOk, Action<Exception> onErr)
{
    Debug.Log($"[DataRegistry] WebGL loading json: {url}");
    using var request = UnityWebRequest.Get(url);
    yield return request.SendWebRequest();

    if (request.result != UnityWebRequest.Result.Success)
    {
        onErr?.Invoke(new InvalidOperationException(
            $"[DataRegistry] Failed to load JSON from {url}: {request.error}"));
        yield break;
    }

    onOk?.Invoke(request.downloadHandler.text);
}

// è¡Œ 203-209: ä» JSON æ–‡æœ¬åˆå§‹åŒ–
public static DataRegistry InitFromJson(string json)
{
    var registry = new DataRegistry();
    registry.LoadFromJson(json);
    _instance = registry;
    return registry;
}
```

---

#### æ–‡ä»¶ 2: `Assets/Scripts/Runtime/GameController.cs` (è¡Œ 43-71)

**å…³é”®éƒ¨åˆ†ï¼šWebGL å¹³å°çš„å¼‚æ­¥åŠ è½½**

```csharp
// è¡Œ 43-71: Start åç¨‹ä¸­çš„ WebGL åŠ è½½é€»è¾‘
private IEnumerator Start()
{
    if (_initialized) yield break;

    if (Application.platform == RuntimePlatform.WebGLPlayer)
    {
        var url = $"{Application.streamingAssetsPath}/game_data.json";
        string json = null;
        Exception error = null;

        yield return DataRegistry.LoadJsonTextCoroutine(
            url,
            text => json = text,
            ex => error = ex
        );

        if (error != null)
        {
            Debug.LogException(error);
            yield break;
        }

        DataRegistry.InitFromJson(json);
        InitGame();
        yield break;
    }

    InitGame();
}
```

**è¯´æ˜ï¼š**
- é WebGL å¹³å°ï¼šåœ¨ `InitGame()` ä¸­è°ƒç”¨ `DataRegistry.Instance` è§¦å‘åŒæ­¥åŠ è½½
- WebGL å¹³å°ï¼šåœ¨ `Start()` åç¨‹ä¸­ä½¿ç”¨ `UnityWebRequest.Get()` å¼‚æ­¥åŠ è½½
- è·¯å¾„æ„å»ºï¼š`Application.streamingAssetsPath + "/game_data.json"`

---

#### æ–‡ä»¶ 3: `Assets/Scripts/Editor/GameDataBuildMenu.cs` (è¡Œ 16-79)

**å…³é”®éƒ¨åˆ†ï¼šç¼–è¾‘å™¨ä¸­çš„å¯¼è¡¨åŠŸèƒ½**

```csharp
// è¡Œ 15-16: é»˜è®¤è·¯å¾„å¸¸é‡
private const string DefaultXlsx = "GameData/Local/game_data.xlsx";
private const string DefaultOut = "Assets/StreamingAssets/game_data.json";

// è¡Œ 18-79: Unity ç¼–è¾‘å™¨èœå•å‘½ä»¤
[MenuItem("Tools/GameData/Build game_data.json (from XLSX)")]
private static void Build()
{
    var repoRoot = GetRepoRoot();
    var python = ResolvePython(repoRoot);

    var xlsx = GetConfiguredPath(K_XLSX, repoRoot, DefaultXlsx);
    var outJson = GetConfiguredPath(K_OUT, repoRoot, DefaultOut);
    var logLevel = EditorPrefs.GetString(K_LEVEL, "INFO");

    // ... æ£€æŸ¥ Python å’Œ openpyxl ä¾èµ– ...

    if (!File.Exists(xlsx))
    {
        EditorUtility.DisplayDialog("GameData", $"XLSX not found:\n{xlsx}", "OK");
        return;
    }

    var script = Path.GetFullPath(Path.Combine(repoRoot, "tools/xlsx_to_json.py"));
    if (!File.Exists(script))
    {
        EditorUtility.DisplayDialog("GameData", $"Script not found:\n{script}", "OK");
        return;
    }

    var outDir = Path.GetDirectoryName(outJson);
    if (!string.IsNullOrEmpty(outDir))
    {
        Directory.CreateDirectory(outDir);
    }

    var args = $"-u \"{script}\" --xlsx \"{xlsx}\" --out \"{outJson}\" --log-level {logLevel}";
    RunProcess(repoRoot, python, args, out var stdout, out var stderr, out var exitCode);

    // ... é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º ...

    if (exitCode != 0)
    {
        EditorUtility.DisplayDialog("GameData Build Failed", $"ExitCode={exitCode}\nSee Console for details.", "OK");
        return;
    }

    AssetDatabase.Refresh();
    Debug.Log($"[GameData] Generated: {outJson}");
}
```

**è¯´æ˜ï¼š**
- Unity ç¼–è¾‘å™¨èœå•ï¼š`Tools/GameData/Build game_data.json (from XLSX)`
- è°ƒç”¨ Python è„šæœ¬ `tools/xlsx_to_json.py`
- è¾“å…¥ï¼š`GameData/Local/game_data.xlsx`
- è¾“å‡ºï¼š`Assets/StreamingAssets/game_data.json`

---

## C) å¯¼è¡¨è„šæœ¬ä¸ç”¨æ³•ï¼ˆå…³é”®ï¼‰

### 7) å¯¼è¡¨è„šæœ¬è·¯å¾„
```
tools/xlsx_to_json.py
```

ä¾èµ–ï¼š
- Python 3
- `openpyxl` åŒ…ï¼ˆç”¨äºè¯»å– Excelï¼‰

---

### 8) è„šæœ¬å…¥å£éƒ¨åˆ†ä»£ç ç‰‡æ®µ (è¡Œ 238-350)

**å‚æ•°è§£æä¸å…¥å£å‡½æ•°ï¼š**

```python
# è¡Œ 238-283: å‚æ•°è§£æå‡½æ•°
def parse_args(argv: list[str]) -> argparse.Namespace:
    # æ”¯æŒæ—§ç‰ˆä½ç½®å‚æ•°ï¼ˆå‘åå…¼å®¹ï¼‰
    legacy_xlsx: str | None = None
    legacy_out: str | None = None
    legacy_tail = argv[1:]
    if len(legacy_tail) >= 2 and not legacy_tail[0].startswith("-") and not legacy_tail[1].startswith("-"):
        legacy_xlsx, legacy_out = legacy_tail[0], legacy_tail[1]

    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument("legacy_xlsx", nargs="?", help=argparse.SUPPRESS)
    parser.add_argument("legacy_out", nargs="?", help=argparse.SUPPRESS)
    parser.add_argument("--xlsx", dest="xlsx", help="Path to game_data.xlsx")
    parser.add_argument("--out", dest="out", help="Path to output game_data.json")
    parser.add_argument(
        "--project-root",
        dest="project_root",
        help="Repository root; defaults to git root or current working directory.",
    )
    parser.add_argument(
        "--log-level",
        dest="log_level",
        default="INFO",
        choices=sorted({"DEBUG", "INFO", "WARN", "ERROR"}),
        help="Logging level (default: INFO)",
    )
    parser.add_argument(
        "--validate-only",
        "--dry-run",
        dest="validate_only",
        action="store_true",
        help="Validate workbook without writing output JSON.",
    )
    parser.add_argument(
        "--no-pretty",
        dest="no_pretty",
        action="store_true",
        help="Emit compact JSON instead of pretty-printed JSON.",
    )

    args = parser.parse_args(argv[1:])

    # å‘åå…¼å®¹ï¼šä½ç½®å‚æ•°ä¼˜å…ˆ
    if not args.xlsx:
        args.xlsx = legacy_xlsx or args.legacy_xlsx
    if not args.out:
        args.out = legacy_out or args.legacy_out

    return args


# è¡Œ 286-342: ä¸»æ‰§è¡Œå‡½æ•°
def run(argv: list[str]) -> int:
    args = parse_args(argv)
    try:
        reporter = Reporter(args.log_level)
    except ValueError as exc:
        print(f"[ERROR] {exc}", file=sys.stderr)
        return 1

    start_time = time.perf_counter()

    # è§£æè·¯å¾„ï¼ˆé»˜è®¤å€¼ï¼‰
    project_root = resolve_project_root(args.project_root)
    xlsx_path = resolve_path(project_root, args.xlsx, "GameData/Local/game_data.xlsx")
    out_path = resolve_path(project_root, args.out, "Assets/StreamingAssets/game_data.json")

    reporter.info("xlsx=%s out=%s", xlsx_path, out_path)

    if not xlsx_path.exists():
        reporter.error("XLSX does not exist: %s", xlsx_path)
        return 1

    try:
        # åŠ è½½ Excel å·¥ä½œç°¿
        workbook = load_workbook(xlsx_path, data_only=True)
        tables, issues = build_tables(workbook, reporter)
        
        # éªŒè¯æ•°æ®
        if issues:
            reporter.error("validate=FAIL issues=%d", len(issues))
            for issue in issues:
                reporter.error(" - %s", issue)
            return 2
        reporter.info("validate=OK")

        # æ„å»º JSON æ•°æ®ç»“æ„
        meta = {}
        meta_table = tables.get("Meta")
        if meta_table and meta_table.get("rows"):
            meta = meta_table["rows"][0]
        data = {
            "meta": meta,
            "tables": tables,
        }
        indent = None if args.no_pretty else 2
        json_text = json.dumps(data, ensure_ascii=False, indent=indent)
        json_bytes = json_text.encode("utf-8")
        reporter.info("json_bytes=%d", len(json_bytes))

        # ä»…éªŒè¯æ¨¡å¼
        if args.validate_only:
            elapsed_ms = (time.perf_counter() - start_time) * 1000
            reporter.success("validate_only elapsed_ms=%.2f", elapsed_ms)
            return 0

        # å†™å…¥æ–‡ä»¶
        out_path.parent.mkdir(parents=True, exist_ok=True)
        out_path.write_bytes(json_bytes)
        size_bytes = out_path.stat().st_size
        elapsed_ms = (time.perf_counter() - start_time) * 1000
        reporter.success("out_bytes=%d elapsed_ms=%.2f", size_bytes, elapsed_ms)
        return 0
    except Exception as exc:
        reporter.error("Unhandled exception during export: %s", exc)
        return 3


# è¡Œ 345-350: å…¥å£ç‚¹
def main() -> None:
    sys.exit(run(sys.argv))


if __name__ == "__main__":
    main()
```

**å…³é”®é€»è¾‘ï¼š**
1. ä½¿ç”¨ `openpyxl` è¯»å– Excel æ–‡ä»¶ï¼ˆ`data_only=True` è¯»å–å€¼è€Œéå…¬å¼ï¼‰
2. è§£ææ¯ä¸ªå·¥ä½œè¡¨ï¼š
   - ç¬¬ 2 è¡Œï¼šå­—æ®µå
   - ç¬¬ 3 è¡Œï¼šå­—æ®µç±»å‹ï¼ˆint, float, string, int[], float[], string[]ï¼‰
   - ç¬¬ 4 è¡Œèµ·ï¼šæ•°æ®è¡Œ
3. éªŒè¯æ•°æ®ï¼ˆé‡å¤ IDã€ç±»å‹é”™è¯¯ç­‰ï¼‰
4. è¾“å‡º JSON æ ¼å¼ï¼š
   ```json
   {
     "meta": { ... },
     "tables": {
       "TableName": {
         "idField": "firstColumnName",
         "columns": [...],
         "rows": [...]
       }
     }
   }
   ```

---

### 9) è¿è¡Œå‘½ä»¤ä¸ç”¨æ³•è¯´æ˜

**åŸºæœ¬ç”¨æ³•ï¼ˆå¸¦é»˜è®¤è·¯å¾„ï¼‰ï¼š**
```bash
python tools/xlsx_to_json.py
```
é»˜è®¤ï¼š
- è¾“å…¥ï¼š`GameData/Local/game_data.xlsx`
- è¾“å‡ºï¼š`Assets/StreamingAssets/game_data.json`

**æŒ‡å®šè·¯å¾„ï¼š**
```bash
python tools/xlsx_to_json.py --xlsx GameData/Local/game_data.xlsx --out Assets/StreamingAssets/game_data.json
```

**æ—§ç‰ˆå…¼å®¹ï¼ˆä½ç½®å‚æ•°ï¼‰ï¼š**
```bash
python tools/xlsx_to_json.py GameData/Local/game_data.xlsx Assets/StreamingAssets/game_data.json
```

**ä»…éªŒè¯ï¼ˆä¸å†™å…¥æ–‡ä»¶ï¼‰ï¼š**
```bash
python tools/xlsx_to_json.py --validate-only
```

**è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼š**
```bash
python tools/xlsx_to_json.py --log-level DEBUG
```

**å‹ç¼© JSONï¼ˆæ— ç¼©è¿›ï¼‰ï¼š**
```bash
python tools/xlsx_to_json.py --no-pretty
```

**ä» Unity ç¼–è¾‘å™¨è°ƒç”¨ï¼š**
- èœå•ï¼š`Tools/GameData/Build game_data.json (from XLSX)`
- è‡ªåŠ¨æ£€æµ‹ Pythonï¼ˆ`python3` æˆ– `python`ï¼‰
- è‡ªåŠ¨å®‰è£… `openpyxl` ä¾èµ–ï¼ˆå¦‚æœç¼ºå¤±ï¼‰
- è¾“å‡ºåˆ° Unity æ§åˆ¶å°

---

## D) ç›®å½•ç­–ç•¥å»ºè®®

### 10) å½“å‰ç›®å½•çŠ¶å†µä¸å»ºè®®

**å½“å‰æ˜¯å¦æœ‰ `Config/` æˆ– `docs/config/` ç›®å½•ï¼Ÿ**
- **æ²¡æœ‰ `Config/` ç›®å½•**ï¼ˆæ ¹ç›®å½•ä¸‹ä¸å­˜åœ¨ï¼‰
- **æ²¡æœ‰ `docs/config/` ç›®å½•**ï¼ˆ`docs/` ç›®å½•æœ¬èº«ä¸å­˜åœ¨ï¼‰
- **æœ‰ `Docs/` ç›®å½•**ï¼ˆå¤§å†™ Dï¼‰ï¼ŒåŒ…å«æŠ€æœ¯æ–‡æ¡£ï¼š
  - `CHANGE_POINTS_CN.md`
  - `DataIntegrationReport.md`
  - `GameDataSchema_v0.1.md`
  - `HP_SAN_Impact_System.md`
- **æœ‰ `GameData/` ç›®å½•**ï¼Œç”¨äºå­˜æ”¾ Excel æºæ–‡ä»¶

**åˆ›å»ºæ–°ç›®å½•æ˜¯å¦ä¼šå½±å“ç°æœ‰å‘å¸ƒï¼Ÿ**

æ ¹æ® `build-webgl.yml` åˆ†æï¼š
1. âœ… **åˆ›å»º `Config/` ä¸ä¼šå½±å“å‘å¸ƒ**
   - Workflow ä¸ä¾èµ–è¯¥ç›®å½•
   - Unity æ„å»ºä¸ä¼šè‡ªåŠ¨åŒ…å«æ ¹ç›®å½•çš„æ™®é€šæ–‡ä»¶å¤¹
   
2. âœ… **åˆ›å»º `docs/config/` ä¸ä¼šå½±å“å‘å¸ƒ**
   - Workflow ä½¿ç”¨ Pages Artifact æœºåˆ¶ï¼Œä¸æ˜¯ `docs/` ç›®å½•å‘å¸ƒ
   - ä¸ä¼šå†²çª

3. âš ï¸ **æ³¨æ„äº‹é¡¹ï¼š**
   - å¦‚æœåˆ›å»º `docs/` ç›®å½•ï¼ˆå°å†™ï¼‰ï¼Œå»ºè®®æ·»åŠ åˆ° `.gitignore` æˆ–æ˜ç¡®å£°æ˜ç”¨é€”
   - å½“å‰æœ‰ `Docs/`ï¼ˆå¤§å†™ï¼‰ï¼Œå»ºè®®ä¿æŒä¸€è‡´å‘½åé£æ ¼

**æ¨èæ”¾ç½®è·¯å¾„ï¼š**

| æ–‡ä»¶ç±»å‹ | å½“å‰è·¯å¾„ | æ¨èè·¯å¾„ï¼ˆå¤‡é€‰ï¼‰ | è¯´æ˜ |
|---------|---------|----------------|------|
| **Excel æºæ–‡ä»¶** | `GameData/Local/game_data.xlsx` | `Config/game_data.xlsx`<br>æˆ– `GameData/game_data.xlsx` | ä¿æŒç°æœ‰ `GameData/Local/` æ›´å¥½ï¼Œé¿å…è·¯å¾„å˜æ›´ |
| **JSON é…ç½®** | `Assets/StreamingAssets/game_data.json` | **ä¿æŒä¸å˜** | Unity å¿…é¡»è·¯å¾„ï¼Œä¸èƒ½æ”¹åŠ¨ |
| **å¯¼è¡¨è„šæœ¬** | `tools/xlsx_to_json.py` | **ä¿æŒä¸å˜** | åˆç†ä½ç½® |
| **é…ç½®æ–‡æ¡£** | `æ¸¸æˆé…ç½®è¯´æ˜.md` | `Docs/æ¸¸æˆé…ç½®è¯´æ˜.md` | ç»Ÿä¸€åˆ° Docs ç›®å½• |

**æœ€ä½³å®è·µå»ºè®®ï¼š**
1. **ä¿æŒç°æœ‰è·¯å¾„ä¸å˜**ï¼Œé¿å…ä»£ç å’Œå·¥ä½œæµä¿®æ”¹
2. å¦‚éœ€æ–°å¢é…ç½®ç›®å½•ï¼š
   - ä½¿ç”¨ `Config/` å­˜æ”¾é¢å¤–é…ç½®ï¼ˆé Unity è¿è¡Œæ—¶ï¼‰
   - ä½¿ç”¨ `Docs/` å­˜æ”¾æ–‡æ¡£ï¼ˆæ³¨æ„å¤§å†™ D ä¿æŒä¸€è‡´ï¼‰
3. Excel å’Œ JSON è·¯å¾„å·²è¢«å¤šå¤„ç¡¬ç¼–ç ï¼Œ**ä¸å»ºè®®ç§»åŠ¨**

---

## ğŸ“Š è¦ç‚¹æ€»ç»“

### Unity Build Workflow
- **åç§°ï¼š** `Build & Deploy Unity WebGL to Pages`
- **æ–‡ä»¶ï¼š** `.github/workflows/build-webgl.yml`
- **è§¦å‘æ¡ä»¶ï¼š**
  - æ¨é€åˆ° `main` åˆ†æ”¯
  - æ‰‹åŠ¨è§¦å‘ (`workflow_dispatch`)
- **å‘å¸ƒç›®å½•ï¼š** `public/`ï¼ˆä¸´æ—¶ç›®å½•ï¼‰ â†’ GitHub Pages Artifact
- **å‘å¸ƒæ–¹å¼ï¼š** GitHub Pagesï¼ˆé€šè¿‡ Actions Artifactï¼Œé gh-pages åˆ†æ”¯æˆ– docs ç›®å½•ï¼‰
- **æ„å»ºå·¥å…·ï¼š** `game-ci/unity-builder@v4`
- **å¹³å°ï¼š** WebGL

### å¯¼è¡¨è„šæœ¬è¿è¡Œå‘½ä»¤
```bash
# åŸºæœ¬ç”¨æ³•ï¼ˆé»˜è®¤è·¯å¾„ï¼‰
python tools/xlsx_to_json.py

# å®Œæ•´å‚æ•°
python tools/xlsx_to_json.py \
  --xlsx GameData/Local/game_data.xlsx \
  --out Assets/StreamingAssets/game_data.json \
  --log-level INFO

# ä»…éªŒè¯
python tools/xlsx_to_json.py --validate-only

# Unity ç¼–è¾‘å™¨
èœå•: Tools/GameData/Build game_data.json (from XLSX)
```

### æ¨èçš„ Excel/JSON æ”¾ç½®è·¯å¾„
- **Excel æºæ–‡ä»¶ï¼š** `GameData/Local/game_data.xlsx`ï¼ˆå½“å‰è·¯å¾„ï¼Œ**å»ºè®®ä¿æŒä¸å˜**ï¼‰
- **JSON è¾“å‡ºï¼š** `Assets/StreamingAssets/game_data.json`ï¼ˆUnity å¿…é¡»è·¯å¾„ï¼Œ**ä¸èƒ½æ”¹åŠ¨**ï¼‰
- **å¤‡ç”¨ Excel å¤‡ä»½ï¼š** `GameData/Local/game_data_back.xlsx`ï¼ˆå·²å­˜åœ¨ï¼‰

### å…³é”®å‘ç°
1. **åŒå¹³å°åŠ è½½æœºåˆ¶ï¼š**
   - é WebGLï¼šåŒæ­¥æ–‡ä»¶è¯»å–ï¼ˆ`File.ReadAllText`ï¼‰
   - WebGLï¼šå¼‚æ­¥ç½‘ç»œåŠ è½½ï¼ˆ`UnityWebRequest.Get`ï¼‰
   
2. **å¯¼è¡¨å·¥ä½œæµï¼š**
   - å¼€å‘ï¼šåœ¨ Unity ç¼–è¾‘å™¨æ‰‹åŠ¨æ‰§è¡Œï¼ˆ`Tools/GameData/Build`ï¼‰
   - è‡ªåŠ¨åŒ–ï¼š**å½“å‰æ²¡æœ‰ CI è‡ªåŠ¨å¯¼è¡¨**ï¼Œéœ€è¦æ‰‹åŠ¨è½¬æ¢åæäº¤

3. **æ”¹è¿›å»ºè®®ï¼š**
   - å¯åœ¨ `build-webgl.yml` ä¸­æ·»åŠ å¯¼è¡¨æ­¥éª¤ï¼š
     ```yaml
     - name: Export game_data.json
       run: |
         python3 -m pip install openpyxl
         python3 tools/xlsx_to_json.py --validate-only
     ```
   - æˆ–åˆ›å»ºå•ç‹¬çš„ `export-data.yml` workflow

---

## ğŸ“ é™„ä»¶ï¼šç›¸å…³æ–‡æ¡£

æœ¬ä»“åº“åŒ…å«ä»¥ä¸‹é‡è¦æ–‡æ¡£ï¼š
- `æ¸¸æˆé…ç½®è¯´æ˜.md` - å®Œæ•´çš„æ¸¸æˆé…ç½®è¡¨ç»“æ„è¯´æ˜
- `WEBGL_ASYNC_LOADING_CHANGES.md` - WebGL å¼‚æ­¥åŠ è½½æ”¹é€ æ–‡æ¡£
- `Docs/GameDataSchema_v0.1.md` - æ•°æ® Schema å®šä¹‰
- `Docs/DataIntegrationReport.md` - æ•°æ®é›†æˆæŠ¥å‘Š

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š** 2026-02-04  
**ä»“åº“ï¼š** hszqf/SCP  
**åˆ†æ”¯ï¼š** main  
